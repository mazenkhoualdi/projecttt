<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IHEC</title>
    <link rel="icon" href="images/ihec.png" />
    <link rel="stylesheet" href="bot.css" />
    <linkh
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <header>
      <a href=""
        ><img src="images/ihec.png " alt="404" style="width: 50% class=logo"
      /></a>
      <nav>
        <ul id="list">
          <li>
            <a href="home.html"><i class="fa-solid fa-bars"></i>Menu</a>
          </li>
        </ul>
      </nav>
    </header>
    <button id="chat-btn" class="chat-btn">
      <i class="fa-solid fa-comment"></i>
    </button>
    <main>
      <img
        src="images/back.png"
        style="width: 100%; height: 600px; border-radius: 40px"
      />
      <div id="chat-container" style="display: none">
        <div class="title-chat">
          <h3>CHATBOT</h3>
          <img
            src="images/ihec.png"
            alt="IHEC Logo"
            style="width: 50px; height: auto"
          />
        </div>

        <div id="chat-window"></div>
        <div id="input-container">
          <div class="QNA">
            <input
              type="text"
              id="user-input"
              placeholder="Posez une question..."
            />
            <button id="send-btn">Envoyer</button>
          </div>
          <div class="rating">
            <div id="rating-container">
              <i class="fa-solid fa-star star" data-value="1"></i>
              <i class="fa-solid fa-star star" data-value="2"></i>
              <i class="fa-solid fa-star star" data-value="3"></i>
              <i class="fa-solid fa-star star" data-value="4"></i>
              <i class="fa-solid fa-star star" data-value="5"></i>
            </div>
            <p class="rating-message"></p>
          </div>
        </div>
      </div>
      <iframe
        id="ifr"
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12769.612349576153!2d10.338563149999999!3d36.8567694!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12e2b5d7c64798d5%3A0xb26905422a3f9e!2sIHEC%20Carthage!5e0!3m2!1sfr!2stn!4v1737853667699!5m2!1sfr!2stn"
        width="600"
        height="450"
        style="border: 0"
        allowfullscreen=""
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
      ></iframe>
      <marquee
        ><h2 id="banner">
          LA VIE √âTUDIANTE CONTINUE SUR LES R√âSEAUX SOCIAUX !<a href="#" id="fb"
            ><i class="fa-brands fa-facebook"></i
          ></a>
          <a href="#" id="ins"><i class="fa-brands fa-instagram"></i></a>
          <a href="#" id="tw"><i class="fa-brands fa-twitter"></i></a>
          <a href="" id="yt"><i class="fa-brands fa-youtube"></i></a></h2
      ></marquee>
    </main>
    <footer>
      <div class="info">
        <img src="images/ihec.png" />
        <ul>
          <li><a href="">Rue Victor Hugo 2016, Carthage-Pr√©sidence></a></li>
          <li><a href="">(+216) 71774720 / 71775948 / 71775592</a></li>
          <li><a href="">Fax: (216) 71775944</a></li>
          <li><a href="">contact@ihec.ucar.tn</a></li>
        </ul>
      </div>
      <div class="info">
        <h3>Institut</h3>
        <ul>
          <li><a href="">Histoire de l'IHEC</a></li>
          <li><a href="">Mission, Vision, valeurs</a></li>
          <li><a href="">Galerie des photos</a></li>
          <li><a href="">Galerie Vid√©os</a></li>
        </ul>
      </div>
      <div class="info">
        <h3>Etudiants</h3>
        <li><a href="">Clubs</a></li>
        <li><a href="">Biblioth√®que</a></li>
        <li><a href="">Culture</a></li>
        <li><a href="">Candidatures mast√®res</a></li>
        <li><a href="">Pr√©-inscriptions en ligne</a></li>
      </div>
      <div class="info">
        <h3>Enseignants</h3>
        <li><a href="">Liste des enseignants</a></li>
        <li><a href="">D√©partement Gestion</a></li>
        <li><a href="">D√©partement Finance</a></li>
      </div>
    </footer>
    <script>
      const chatWindow = document.getElementById("chat-window");
      const userInput = document.getElementById("user-input");
      const sendBtn = document.getElementById("send-btn");
      const chatContainer = document.getElementById("chat-container");
      const chatBtn = document.getElementById("chat-btn");
      const ratingContainer = document.getElementById("rating-container");
      const stars = document.querySelectorAll(".star");
      const ratingMessage = document.querySelector(".rating-message");

    
      const greetings = {
        en: ["hello", "hi", "welcome"],
        fr: ["bonjour", "salut", "bienvenue"],
      };
      const farewells = {
        en: ["bye", "goodbye", "see you", "thank you", "thanks", "nice"],
        fr: ["au revoir", "√† bient√¥t", "adieu", "merci"],
      };

  
      chatBtn.addEventListener("click", () => {
        const buttonRect = chatBtn.getBoundingClientRect();

        chatContainer.style.left = `${buttonRect.right - 310}px`;
        chatContainer.style.top = `${buttonRect.top + 200}px`;

        if (chatContainer.style.display === "none") {
          chatContainer.style.display = "block";
        } else {
          chatContainer.style.display = "none";
        }
      });

 
      sendBtn.addEventListener("click", () => {
        const question = userInput.value.trim().toLowerCase();
        if (!question) return;

        addMessage(question, "user-message");

       
        if (isGreeting(question)) {
          addMessage(getWelcomeResponse(question), "bot-message");
        } else if (isFarewell(question)) {
          addMessage(getFarewellResponse(question), "bot-message");
        } else {
      
          fetch("http://localhost:3000/chatbot", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question }),
          })
            .then((res) => res.json())
            .then((data) => {
              addMessage(data.response, "bot-message");
            })
            .catch(() => {
              addMessage(
                "Erreur : Impossible de contacter le serveur.",
                "bot-message"
              );
            });
        }

        userInput.value = "";

        
        ratingContainer.style.display = "flex";
      });

    
      function addMessage(text, className) {
        const message = document.createElement("div");
        message.className = `message ${className}`;
        message.textContent = text;
        chatWindow.appendChild(message);

       
        chatWindow.scrollTop = chatWindow.scrollHeight;
      }

      
      function isGreeting(message) {
        return (
          greetings.en.includes(message.toLowerCase()) ||
          greetings.fr.includes(message.toLowerCase())
        );
      }

      
      function isFarewell(message) {
        return (
          farewells.en.includes(message.toLowerCase()) ||
          farewells.fr.includes(message.toLowerCase())
        );
      }

      
      function getWelcomeResponse(message) {
        if (greetings.en.includes(message.toLowerCase())) {
          return "Hello! How can I assist you today? üòä";
        } else if (greetings.fr.includes(message.toLowerCase())) {
          return "Bonjour ! Comment puis-je vous aider aujourd'hui ? üòä";
        }
      }

   
      function getFarewellResponse(message) {
        if (farewells.en.includes(message.toLowerCase())) {
          return "Goodbye! Have a great day! üëã";
        } else if (farewells.fr.includes(message.toLowerCase())) {
          return "Au revoir ! Passez une excellente journ√©e ! üëã";
        }
      }

     
      stars.forEach((star) => {
        star.addEventListener("click", (e) => {
          const value = e.target.dataset.value;

      
          stars.forEach((s) => {
            s.classList.remove("selected");
            if (s.dataset.value <= value) {
              s.classList.add("selected");
            }
          });

        
          ratingMessage.textContent = `Merci pour votre note de ${value} √©toile(s) !`;
        });
      });
    </script>
  </body>
</html>
